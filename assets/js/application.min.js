"use strict";const DOM=function(){return{create:function(e,t){let n=e=>Array.isArray(e);if(!n(e))return make.call(this,Array.prototype.slice.call(arguments));let o=e[0],r=e[1],a=document.createElement(o),l=1;if("object"==typeof r&&null!==r&&!n(r)){for(let e in r)a[e]=r[e];l=2}for(let t=l;t<e.length;t++)n(e[t])?a.appendChild(DOM.create(e[t])):a.appendChild(document.createTextNode(e[t]));return t&&t(),a},insert:function(e,t){let n;return UI.main,n=e.output?e.output:config.output,"object"==typeof e?e.html?e.append?n.appendChild(DOM.create(e.tag,{id:e.id},e.html)):n.innerHTML=e.html:(n.innerHTML="",n.appendChild(e)):n.innerHTML=e,t&&t(),n}}}(),utils=function(){const e=e=>({properties:Object.getOwnPropertyNames(e),values:Object.values(e)});return{getRandomInt:(e,t)=>Math.floor(Math.random()*(t-e+1))+e,obj:e,params:e=>{const t=e.toString().replace(/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,""),n=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(/([^\s,]+)/g);return null===n&&(n=[]),n},elements:t=>{const n=e(t);for(let e in n.properties)t[n.properties[e]]=view.element(n.values[e]);return t},format:e=>e.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/(?:\r\n|\r|\n)/g,"<br>"),isNode:e=>"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName,isElement:e=>"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName,formData:e=>{let t={},n=new FormData(e);for(let e of n.entries())t[e[0]]=e[1];return t},occurence:(e,t)=>(e.match(new RegExp(`${t}`,"g"))||[]).length}}(),view=function(){const e=[],t=function(t){for(let n of e)if(n.id===t)return n.element},n=function(n){return t(n)?t(n):("string"==typeof n&&(n.includes(".")?n=(()=>document.querySelectorAll(n))():(n.includes("#")||(n=`#${n}`),n=(()=>document.querySelector(n))())),n&&(n.id||(n.id=`view_element_${e.length+1}`),e.push({id:n.id,element:n})),n)},o=function(e,t){return t=document.createTextNode(t),n(e).appendChild(t),e},r=function(e,t){const n=Object.getOwnPropertyNames(t);for(let o in n)e.setAttribute(n[o],Object.values(t)[o]);return e},a=function(e,t,a,l){return"string"==typeof e&&(e=n(e)),"string"==typeof t&&(t=document.createElement(t)),"object"==typeof a&&(t=r(t,a)),"string"==typeof a&&(l=a),"string"==typeof l&&o(t,l),e.appendChild(t),t};return n.prototype.txt=function(t){return t(e[e.length].element,t)},n.prototype.add=function(t,n,o){return a(e[e.length].element,t,n,o)},n.prototype.attr=function(t){return r(e[e.length].element,t)},{elements:e,element:n,get:t,add:a,set:function(e,t){return"string"==typeof e&&(e=n(e)),"object"==typeof t?utils.isElement(t)&&e.appendChild(t):"string"==typeof t&&(e.innerHTML=t),e},txt:o,attr:r}}(),model=function(){const e={};utils.obj;return{data:e,components:[],get:(t,n)=>e[n].find(e=>parseInt(e.id)===parseInt(t)),load:e=>{model.components=e.components;for(let t of model.components)model.apiRequest({api:e.api,endpoint:t.endpoint})},apiRequest:(t,n)=>{let o=new XMLHttpRequest;t.type||(t.type="GET"),t.status||(t.status=200),o.addEventListener("load",r=>{4===o.readyState&&o.status===t.status&&(e[t.component]=JSON.parse(r.target.responseText),n&&n(r,t))}),o.open(t.type,`http://${t.api}/${t.endpoint}`,!0),o.send(t.data)}}}(),controller=function(){const e=[],t=[],n=function(t){const n=t.target.id;for(let t of e)t.component===n&&t.do()};return{actions:e,events:t,add:function(e,o,r){"string"==typeof e&&(e=view.element(e)),t.push({event:event,element:e,action:o}),e.addEventListener(o,e=>{e.preventDefault(),r(e),n(e)})},component:function(t,n,o){e.push({component:t.id,event:n,do:o})}}}(),UI=function(){const e=view.set,t=view.add;return{addComponent:e=>{const t=e=>DOM.create([e.element,{id:e.id,class:e.class},e.html]);for(let n of e.components)this[e.fn]=(()=>{const n=t(e);return e.callback&&e.callback(n),n})},overviewTable:n=>{n.data||console.error("UI.overview : args.data is undefined");const o=DOM.create(["table",{id:`overview_${n.component}`,class:"table"}]),r=DOM.create(["thead"]),a=DOM.create(["tr"]),l=DOM.create(["tbody"]),i=DOM.create(["h2",`${n.data.length} ${n.title}`]);n.fields=utils.obj(n.fields);for(let t of n.fields.properties)e(a,DOM.create(["th",t]));e(o,e(r,a));for(let o of n.data){let r=DOM.create(["tr",{id:o.id}]);n.controller&&controller.add(r,"click",n.controller);for(let a of n.fields.values){let n=DOM.create(["td"]);t(r,e(n,a(o)))}t(l,r)}e(n.target,""),e(n.target,i),e(n.target,e(o,l)),n.callback&&n.callback()},createForm:e=>{const t=make(["form",{id:`create_form_ ${e.component}`}]);make(["h2","Add item"]);e.fields=utils.obj(e.fields),e.controller&&controller.add(t,"submit",e.controller)},update:e=>{},delete:e=>{}}}();window.UI=UI;const application=function(){let e,t,n,o,r,a,l,i;const c=utils.obj,s=view.element,d=(view.add,()=>location.hash.slice(1).split("/")),u=t=>{const n=e,o=d(n.config),r=o[0]?o[0]:n.config.default;o[1]?n[r][o[1]](o[2]):n[r].default()},p={},f=(e,t,n)=>{"function"==typeof e&&(e=/function ([^(]*)/.exec(e+"")[1]),p[`before:${e}.${t}`]&&p[`before:${e}.${t}`]()},m=(e,t)=>{"function"==typeof e&&(e=/function ([^(]*)/.exec(e+"")[1]),t&&p[`${e}.${t}`]?p[`${e}.${t}`]():p[e]&&p[e]()};return{route:d,config:n,init:d=>{e=d,t=c(d),n=e.config,o=s(n.main),r=s(n.nav),a=t.properties,l=t.values,r&&(()=>{for(let t of a)if(e[t].name){let n=view.add(r,"li",{id:t});const o=e.config.navMenuItemPrefix?e.config.navMenuItemPrefix:"#";view.add(n,"a",{href:`${o}${t}`},e[t].name)}})(),i=n.loadEvent?n.loadEvent:"hashchange",controller.add(window,i,e=>u()),controller.add(window,"load",e=>u())},call:(t,n,o)=>{o.target||(o.target=e.config.main),o.data=model.data[o.component],o.config=e.config,f(t,n,o.target),"string"==typeof t?window[t][n](o):"function"==typeof t&&(n?t()[n](o):t(n)),m(t,n)},hooks:p,before:(e,t,n)=>{e=e(e),t?p[`before:${e}.${t}`]=n:p[`before:${e}`]=t},hook:(e,t,n)=>{e=e(e),t?p[`${e}.${t}`]=n:p[e]=t},callbefore:f,callback:m}}(),client=function(){function e(e){"string"==typeof e&&(e={url:e});const t=new XMLHttpRequest;e.method||(e.method="GET"),e.status||(e.status=200),t.open(e.method,e.url,!0),t.setRequestHeader("Content-Type","application/json"),e.data&&(e.data=JSON.stringify(e.data)),t.addEventListener("load",n=>{4===t.readyState&&t.status===e.status&&e.callback&&e.callback(n)}),t.send(e.data)}const t={},n=(n,o)=>{t[n.route][o]=(t=>{"post"===o&&(t={url:`${url}${n.route}`,data:t.data,method:"POST",status:201,callback:t.callback}),"get"===o&&(t={url:`${url}${n.route}}/${t.id}`,callback:t.callback}),"getAll"===o&&(t={url:`${url}${n.route}}`,callback:t.callback}),"put"===o&&(t={data:t.data,url:`${url}${n.route}/${t.id}`,method:"PUT",status:201}),"delete"===o&&(t={url:`${url}${n.route}/${t.id}`,method:"DELETE",status:201}),e(t)})},o=e=>{const t=JSON.parse(e.target.responseText);for(let e of t){for(let t of e.methods)n(e,t);let t=e.route;config.application[t]}};return{api:t=>{e({url:`${`http://${t.server}/${t.api}/`}routes`,callback:o})},request:t}}();
